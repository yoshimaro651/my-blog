---
import fs from 'fs';
import path from 'path';
import { marked } from 'marked';

// Markdown記事のあるフォルダ
const postsDir = './src/content/blog';

// フォルダ内のファイル名を取得
const files = fs.readdirSync(postsDir);

// 各MarkdownをHTMLに変換
const posts = files.map(file => {
  const content = fs.readFileSync(path.join(postsDir, file), 'utf-8');
  const html = marked(content);
  
  // frontmatter（タイトルなど）を簡易取得
  const match = content.match(/---\s*title:\s*(.+)\s*date:/);
  const title = match ? match[1] : file;

  return { title, html };
});
---

<html>
  <head>
    <title>ブログサイト</title>
  </head>
  <body>
    <h1>ブログ記事一覧</h1>
    {posts.map(post => (
      <article style="border-bottom:1px solid #ccc; margin-bottom:20px;">
        <h2>{post.title}</h2>
        <div innerHTML={post.html}></div>
      </article>
    ))}
  </body>
</html>